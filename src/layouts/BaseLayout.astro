---
import "../styles/global.css";
import '@fontsource-variable/dm-sans';
import '@fontsource-variable/space-grotesk';
import {ClientRouter} from 'astro:transitions';
import {Picture} from 'astro:assets';
import profilePic from '../assets/profile.png';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';

interface Props {
    pageAuthor?: string;
    pageTitle?: string;
    pageDescription?: string;
}

const {
    pageAuthor = "Sander de Jong",
    pageTitle = "Sander de Jong - Software & AWS Cloud Engineer",
    pageDescription = "Software developer passionate about cloud-native, Java, and AWS. Building scalable, secure, and performance-driven solutions."
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site || Astro.url.origin);
const socialImageURL = new URL('/favicon.svg', Astro.url);
---

<html lang="en">
<head>
    <script is:inline>
        // Apply theme immediately to prevent flash of unstyled content
        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
            }
            
            // Set initial theme color
            const metaThemeColor = document.querySelector('meta[name="theme-color"]');
            if (metaThemeColor) {
               metaThemeColor.setAttribute('content', savedTheme === 'dark' ? '#111827' : '#f9fafb');
            }
        })();

        // Persist theme class during Astro view transitions
        document.addEventListener('astro:before-swap', (ev) => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                ev.newDocument.documentElement.classList.add('dark');
            }
        });
    </script>
    <title>{pageTitle}</title>

    <link rel="canonical" href={canonicalURL}/>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg"/>
    <link rel="sitemap" href="/sitemap-index.xml"/>

    <meta charset="utf-8"/>
    <meta name="author" content={pageAuthor}/>
    <meta name="description" content={pageDescription}/>
    <meta name="viewport" content="width=device-width"/>
    <meta name="generator" content={Astro.generator}/>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website"/>
    <meta property="og:url" content={Astro.url}/>
    <meta property="og:title" content={pageTitle}/>
    <meta property="og:description" content={pageDescription}/>
    <meta property="og:image" content={socialImageURL}/>

    <!-- X -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:url" content={Astro.url}/>
    <meta name="twitter:title" content={pageTitle}/>
    <meta name="twitter:description" content={pageDescription}/>
    <meta name="twitter:image" content={socialImageURL}/>

    <meta name="robots" content="index, follow"/>
    <meta name="theme-color" content="#f9fafb"/>
    <ClientRouter/>
</head>

<body>
<Navbar />
<div class="bg-artifacts" transition:persist="bg">
    <div class="artifact artifact-1"></div>
    <div class="artifact artifact-2"></div>
    <div class="artifact artifact-3"></div>
</div>
<main class="layout">
    <section class="layout-wrapper">
        <div class="sidebar">
            <div class="sidebar-inner" transition:persist="sidebar" transition:animate="none">
                <aside class="profile">
                    <div class="profile-wrapper">
                        <Picture src={profilePic}
                                 loading="eager"
                                 format="webp"
                                 alt="Profile picture of Sander de Jong"
                                 class="profile-image"
                                 width={460}
                                 height={460}
                        />
                    </div>
                </aside>

                <div class="divider" role="presentation"></div>
            </div>
        </div>

        <article class="content">
            <slot/>
        </article>
    </section>
</main>
<Footer author={pageAuthor} />

<script is:inline>
    (function() {
        const sidebar = document.querySelector('.sidebar-inner');
        if (sidebar && !sidebar.hasAttribute('data-animated')) {
            sidebar.addEventListener('animationend', () => {
                sidebar.setAttribute('data-animated', 'true');
            }, { once: true });
        }
    })();
</script>
</body>
</html>

<style>
    .layout {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 1;
        width: 100%;
        padding-top: 5rem; /* Account for fixed navbar height */
    }

    .layout-wrapper {
        display: flex;
        flex-direction: row;
        gap: 4rem;
        align-items: flex-start;
        justify-content: center;
        width: 100%;
        max-width: 1800px;
        margin: 0 auto;
    }

    .sidebar {
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        justify-content: center;
        gap: 4rem;
        position: relative;
        width: calc(clamp(200px, 20vw, 450px) + 4rem + 2px); /* profile + gap + divider */
    }

    .sidebar-inner {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 4rem;
        position: fixed;
        top: 50%;
        transform: translateY(-50%);
    }

    .sidebar-inner:not([data-animated]) {
        opacity: 0;
        animation: fadeInProfile 0.5s ease-out forwards;
    }

    @keyframes fadeInProfile {
        from {
            opacity: 0;
            transform: translateY(calc(-50% + 10px));
        }
        to {
            opacity: 1;
            transform: translateY(-50%);
        }
    }

    @keyframes fadeInProfileMobile {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeInContent {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .profile {
        display: flex;
        align-items: center;
        justify-content: flex-end;
    }

    .profile-wrapper {
        position: relative;
    }

    .profile-image {
        width: clamp(200px, 20vw, 450px);
        height: clamp(200px, 20vw, 450px);
        object-fit: cover;
        border-radius: 50%;
        padding: 4px;
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.5), rgba(245, 158, 66, 0.5));
        box-shadow: -6px 12px 32px -4px rgba(37, 99, 235, 0.25),
        6px 12px 32px -4px rgba(245, 158, 66, 0.25);
        transition: box-shadow 0.3s, transform 0.3s;
        filter: saturate(1.09) contrast(1.07);
        transform: scale(1.02);
    }

    .divider {
        width: 2px;
        height: 350px;
        background: var(--color-border);
        border-radius: 1px;
        flex-shrink: 0;
    }

    .content {
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: clamp(2rem, 4vh, 4rem) clamp(2rem, 5vw, 5rem) clamp(2rem, 4vh, 4rem) 0;
        max-width: 600px;
        opacity: 0;
        animation: fadeInContent 0.6s ease-out 0.2s forwards;
    }

    .bg-artifacts {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
    }

    .artifact {
        position: absolute;
        border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
        opacity: 0.08;
        filter: blur(60px);
    }

    .artifact-1 {
        width: clamp(200px, 30vw, 450px);
        height: clamp(200px, 30vw, 450px);
        background: linear-gradient(135deg, #f59e42, #ea580c);
        top: 5%;
        left: 25%;
    }

    .artifact-2 {
        width: clamp(180px, 25vw, 400px);
        height: clamp(180px, 25vw, 400px);
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        top: 50%;
        right: 5%;
    }

    .artifact-3 {
        width: clamp(150px, 20vw, 350px);
        height: clamp(150px, 20vw, 350px);
        background: linear-gradient(135deg, #8b5cf6, #6366f1);
        bottom: 15%;
        left: 20%;
    }

    main {
        position: relative;
        z-index: 1;
    }


    @media (max-width: 1024px) {
        .layout {
            padding-top: 1rem;
            justify-content: flex-start;
        }

        .layout-wrapper {
            flex-direction: column;
            align-items: center;
            gap: 0;
        }

        .sidebar {
            flex-direction: column;
            align-items: center;
            position: relative;
            top: 0;
            height: auto;
            width: 100%;
        }

        .sidebar-inner {
            flex-direction: column;
            position: relative;
            top: 0;
            transform: none;
            width: 100%;
            align-items: center;
            gap: 0;
        }

        .sidebar-inner:not([data-animated]) {
            animation: fadeInProfileMobile 0.5s ease-out forwards;
        }

        .profile {
            position: relative;
            height: auto;
            min-height: auto;
            padding: 1rem 1rem 0;
            justify-content: center;
            align-items: center;
            width: 100%;
            top: 0;
            transform: none;
        }

        .divider {
            width: 80%;
            max-width: 300px;
            height: 2px;
            position: relative;
            top: auto;
            margin: 2rem 0;
            align-self: center;
            transform: none;
        }

        .content {
            padding: 0 1.5rem 4rem;
            min-height: auto;
            width: 100%;
            align-items: center;
        }
    }
</style>

